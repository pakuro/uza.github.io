<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Infinity Crafter RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background: #121212; color: #e0e0e0;
            font-family: 'Roboto Mono', monospace;
            margin: 0; padding: 20px;
            display: flex; justify-content: center; height: 95vh;
        }

        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        #game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr;
            gap: 15px;
            width: 1000px; height: 100%;
        }

        .panel {
            background: #1e1e1e; border: 2px solid #333;
            border-radius: 8px; padding: 15px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        h2 { margin-top: 0; border-bottom: 2px solid #444; padding-bottom: 5px; font-size: 18px; color: #aaa; }
        
        /* ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ */
        #battle-panel { grid-row: 1 / 3; display: flex; flex-direction: column; }
        #enemy-view {
            flex-grow: 1; background: #000; border: 1px solid #444;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin-bottom: 10px; position: relative;
        }
        #enemy-emoji { font-size: 80px; transition: transform 0.1s; cursor: pointer; user-select: none; }
        #enemy-emoji:active { transform: scale(0.9); }
        
        .bar-container { width: 80%; height: 20px; background: #333; margin: 5px 0; border-radius: 10px; overflow: hidden; position: relative;}
        .bar-fill { height: 100%; transition: width 0.2s; }
        .hp-fill { background: #ff4444; }
        .xp-fill { background: #44ff88; }
        .bar-text { position: absolute; width: 100%; text-align: center; top: 0; line-height: 20px; font-size: 12px; color: white; text-shadow: 1px 1px 0 #000; }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .zones { display: flex; gap: 5px; margin-bottom: 10px; }
        .zone-btn {
            background: #333; color: #888; border: 1px solid #555;
            padding: 5px 10px; cursor: pointer; font-family: inherit;
        }
        .zone-btn.active { background: #e0e0e0; color: #000; font-weight: bold; }

        /* ãƒ­ã‚° */
        #log { height: 100px; background: #000; font-size: 12px; padding: 5px; overflow-y: scroll; color: #888; border: 1px solid #333; }
        .log-loot { color: #ffd700; }
        .log-lvl { color: #00ff88; font-weight: bold; }

        /* ã‚¯ãƒ©ãƒ•ãƒˆ & ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª */
        .item-list { display: flex; flex-direction: column; gap: 5px; }
        .item-row {
            display: flex; justify-content: space-between; align-items: center;
            background: #2a2a2a; padding: 8px; border-radius: 4px; border: 1px solid #333;
        }
        .item-info { display: flex; flex-direction: column; }
        .item-name { font-weight: bold; }
        .item-req { font-size: 11px; color: #888; }
        
        /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£è‰² */
        .rarity-1 { color: #fff; } /* Common */
        .rarity-2 { color: #4488ff; } /* Rare */
        .rarity-3 { color: #d044ff; } /* Epic */
        .rarity-4 { color: #ffcc00; text-shadow: 0 0 5px rgba(255,200,0,0.5); } /* Legendary */

        button.craft-btn, button.equip-btn {
            background: #333; color: white; border: 1px solid #555;
            padding: 5px 10px; cursor: pointer; font-family: inherit;
        }
        button.craft-btn:hover { background: #555; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        #stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px; }
        .stat-val { font-weight: bold; color: white; }

        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç”¨ï¼ˆã‚¹ãƒãƒ›ãªã©ç”»é¢ãŒç‹­ã„ã¨ãç”¨ã ãŒä»Šå›ã¯PCæƒ³å®šã§å…¨è¡¨ç¤ºï¼‰ */
    </style>
</head>
<body>

<div id="game-container">
    <div id="battle-panel" class="panel">
        <h2>âš”ï¸ BATTLE ZONE</h2>
        <div class="zones">
            <button class="zone-btn active" onclick="setZone(0)">Zone 1: å¹³åŸ</button>
            <button class="zone-btn" onclick="setZone(1)">Zone 2: æ£®æ—</button>
            <button class="zone-btn" onclick="setZone(2)">Zone 3: ç«å±±</button>
            <button class="zone-btn" onclick="setZone(3)">Zone 4: é­”ç•Œ</button>
        </div>

        <div id="enemy-view" onclick="playerAttack()">
            <div style="position:absolute; top:10px; color:#888;">CLICK TO ATTACK</div>
            <div id="enemy-emoji">slime</div>
            <h3 id="enemy-name">Slime</h3>
            
            <div class="bar-container">
                <div id="enemy-hp-bar" class="bar-fill hp-fill" style="width: 100%"></div>
                <div id="enemy-hp-text" class="bar-text">HP: 50/50</div>
            </div>
        </div>

        <div class="bar-container">
            <div id="xp-bar" class="bar-fill xp-fill" style="width: 0%"></div>
            <div id="xp-text" class="bar-text">LV.1 (0/100)</div>
        </div>

        <div id="log"></div>
    </div>

    <div class="panel">
        <h2>ğŸ‘¤ STATUS & EQUIPMENT</h2>
        <div id="stats-grid">
            <div>LV: <span id="st-lv" class="stat-val">1</span></div>
            <div>HP: <span id="st-hp" class="stat-val">100/100</span></div>
            <div>ATK: <span id="st-atk" class="stat-val">10</span></div>
            <div>DEF: <span id="st-def" class="stat-val">0</span></div>
        </div>
        <hr style="border-color:#333">
        <div>Weap: <span id="eq-weap" class="rarity-1">None</span></div>
        <div>Armor: <span id="eq-armor" class="rarity-1">None</span></div>

        <h2>ğŸ’ MATERIALS</h2>
        <div id="material-list" style="font-size:12px; display: grid; grid-template-columns: 1fr 1fr; gap:5px;">
            </div>
    </div>

    <div class="panel">
        <h2>ğŸ”¨ BLACKSMITH (Crafting)</h2>
        <div id="recipe-list" class="item-list">
            </div>
    </div>
</div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
    const MATERIALS = {
        'gel': { name: 'ã‚¹ãƒ©ã‚¤ãƒ ã‚¼ãƒªãƒ¼', rarity: 1 },
        'stone': { name: 'ç¡¬ã„çŸ³', rarity: 1 },
        'wood': { name: 'ä¸ˆå¤«ãªæ', rarity: 1 },
        'iron': { name: 'é‰„é‰±çŸ³', rarity: 2 },
        'fang': { name: 'çŒ›ç£ã®ç‰™', rarity: 2 },
        'obsidian': { name: 'é»’æ›œçŸ³', rarity: 3 },
        'scale': { name: 'ç«œã®é±—', rarity: 3 },
        'orb': { name: 'é­”ç‹ã®å®ç‰', rarity: 4 }
    };

    const ENEMIES = [
        // Zone 0
        { name: 'Slime', emoji: 'ğŸ’§', hp: 30, atk: 5, xp: 10, drop: 'gel', rate: 0.7 },
        { name: 'Golem', emoji: 'ğŸ—¿', hp: 60, atk: 8, xp: 20, drop: 'stone', rate: 0.5 },
        // Zone 1
        { name: 'Treant', emoji: 'ğŸŒ³', hp: 150, atk: 15, xp: 40, drop: 'wood', rate: 0.6 },
        { name: 'Wolf', emoji: 'ğŸº', hp: 120, atk: 25, xp: 50, drop: 'fang', rate: 0.5 },
        // Zone 2
        { name: 'Knight', emoji: 'ğŸ›¡ï¸', hp: 400, atk: 40, xp: 100, drop: 'iron', rate: 0.5 },
        { name: 'Dragon', emoji: 'ğŸ‰', hp: 800, atk: 80, xp: 200, drop: 'scale', rate: 0.4 },
        // Zone 3
        { name: 'Demon', emoji: 'ğŸ‘¿', hp: 2000, atk: 150, xp: 500, drop: 'obsidian', rate: 0.4 },
        { name: 'Overlord', emoji: 'ğŸ‘‘', hp: 5000, atk: 300, xp: 2000, drop: 'orb', rate: 1.0 }
    ];

    const RECIPES = [
        { id: 'w1', name: 'çŸ³ã®å‰£', type: 'weapon', atk: 10, def: 0, req: { 'stone': 3, 'gel': 2 }, rarity: 1 },
        { id: 'a1', name: 'æœ¨ã®ç›¾', type: 'armor', atk: 0, def: 5, req: { 'wood': 3, 'gel': 2 }, rarity: 1 },
        { id: 'w2', name: 'ç‹¼ç‰™ã®çŸ­å‰£', type: 'weapon', atk: 25, def: 0, req: { 'fang': 5, 'wood': 2 }, rarity: 2 },
        { id: 'a2', name: 'é‰„ã®é§', type: 'armor', atk: 0, def: 15, req: { 'iron': 5, 'stone': 5 }, rarity: 2 },
        { id: 'w3', name: 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼', type: 'weapon', atk: 80, def: 10, req: { 'scale': 3, 'iron': 10, 'obsidian': 2 }, rarity: 3 },
        { id: 'a3', name: 'ç«œé±—ã®ç›¾', type: 'armor', atk: 5, def: 40, req: { 'scale': 5, 'iron': 5 }, rarity: 3 },
        { id: 'w4', name: 'é­”å‰£ã‚°ãƒ©ãƒ ', type: 'weapon', atk: 200, def: 20, req: { 'orb': 1, 'obsidian': 10, 'scale': 5 }, rarity: 4 },
        { id: 'a4', name: 'ç¥ã®é§', type: 'armor', atk: 20, def: 100, req: { 'orb': 1, 'obsidian': 10, 'iron': 20 }, rarity: 4 }
    ];

    // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
    let player = {
        lv: 1, xp: 0, nextXp: 100,
        hp: 100, maxHp: 100,
        baseAtk: 5, baseDef: 0,
        inventory: {}, // { 'gel': 10, 'stone': 2 ... }
        equipment: { weapon: null, armor: null },
        unlockedRecipes: [] // æœ¬æ¥ã¯é€²è¡Œåº¦ã§è§£æ”¾ã™ã‚‹ãŒä»Šå›ã¯å…¨è¡¨ç¤º
    };

    let currentZone = 0;
    let currentEnemy = null; // { ...stats, maxHp }
    let combatTimer = null;

    // --- åˆæœŸåŒ– ---
    function init() {
        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªåˆæœŸåŒ–
        for(let key in MATERIALS) player.inventory[key] = 0;
        spawnEnemy();
        updateUI();
        
        // è‡ªå‹•å›å¾©ãƒ«ãƒ¼ãƒ—
        setInterval(() => {
            if(player.hp < player.maxHp) {
                player.hp = Math.min(player.maxHp, player.hp + Math.max(1, Math.floor(player.maxHp * 0.05)));
                updateStatsUI();
            }
        }, 1000);
    }

    // --- ãƒãƒˆãƒ«ã‚·ã‚¹ãƒ†ãƒ  ---
    function setZone(z) {
        currentZone = z;
        document.querySelectorAll('.zone-btn').forEach((b, i) => {
            b.classList.toggle('active', i === z);
        });
        spawnEnemy();
        log(`Zone ${z+1} ã«ç§»å‹•ã—ã¾ã—ãŸ`);
    }

    function spawnEnemy() {
        const zoneEnemies = ENEMIES.slice(currentZone * 2, currentZone * 2 + 2);
        const template = zoneEnemies[Math.floor(Math.random() * zoneEnemies.length)];
        
        currentEnemy = { ...template, maxHp: template.hp };
        updateBattleUI();
    }

    function playerAttack() {
        if (!currentEnemy || currentEnemy.hp <= 0) return;

        // ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
        const stats = getPlayerStats();
        // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«åˆ¤å®š
        const isCrit = Math.random() < 0.1;
        let dmg = Math.floor(stats.atk * (0.9 + Math.random() * 0.2));
        if(isCrit) dmg *= 2;

        currentEnemy.hp -= dmg;
        
        // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        const emoji = document.getElementById('enemy-emoji');
        emoji.style.transform = "scale(0.8) rotate(10deg)";
        setTimeout(() => emoji.style.transform = "scale(1) rotate(0deg)", 100);

        if (currentEnemy.hp <= 0) {
            winBattle();
        } else {
            enemyAttack();
        }
        updateBattleUI();
    }

    function enemyAttack() {
        const stats = getPlayerStats();
        let dmg = Math.max(1, currentEnemy.atk - stats.def);
        // ãƒ©ãƒ³ãƒ€ãƒ å¹…
        dmg = Math.floor(dmg * (0.9 + Math.random() * 0.2));
        
        player.hp = Math.max(0, player.hp - dmg);
        if (player.hp <= 0) {
            log(`ã‚ãªãŸã¯å€’ã‚ŒãŸ... (HPãŒå›å¾©ã™ã‚‹ã¾ã§å¾…æ©Ÿ)`);
            player.hp = 0; // ãã®ã¾ã¾
        }
    }

    function winBattle() {
        const dropItem = MATERIALS[currentEnemy.drop];
        const gotDrop = Math.random() < currentEnemy.rate;
        
        // XPç²å¾—
        player.xp += currentEnemy.xp;
        let logMsg = `<b>${currentEnemy.name}</b>ã‚’å€’ã—ãŸ! XP+${currentEnemy.xp}`;
        
        // ãƒ‰ãƒ­ãƒƒãƒ—ç²å¾—
        if(gotDrop) {
            player.inventory[currentEnemy.drop]++;
            logMsg += ` <span class="log-loot">[${dropItem.name}]GET!</span>`;
        }

        log(logMsg);

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—åˆ¤å®š
        if(player.xp >= player.nextXp) {
            player.lv++;
            player.xp -= player.nextXp;
            player.nextXp = Math.floor(player.nextXp * 1.5);
            player.maxHp += 20;
            player.baseAtk += 2;
            player.hp = player.maxHp;
            log(`<span class="log-lvl">LEVEL UP! Lv.${player.lv}</span>`);
        }

        setTimeout(spawnEnemy, 500);
        updateUI();
    }

    // --- ã‚¯ãƒ©ãƒ•ãƒˆã‚·ã‚¹ãƒ†ãƒ  ---
    function craft(recipeId) {
        const recipe = RECIPES.find(r => r.id === recipeId);
        
        // ç´ ææ¶ˆè²»
        for(let mat in recipe.req) {
            player.inventory[mat] -= recipe.req[mat];
        }

        // è£…å‚™
        if(recipe.type === 'weapon') player.equipment.weapon = recipe;
        if(recipe.type === 'armor') player.equipment.armor = recipe;

        log(`${recipe.name}ã‚’ä½œæˆã—ã€è£…å‚™ã—ã¾ã—ãŸï¼`);
        updateUI();
    }

    function canCraft(recipe) {
        for(let mat in recipe.req) {
            if(player.inventory[mat] < recipe.req[mat]) return false;
        }
        return true;
    }

    // --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨ˆç®— ---
    function getPlayerStats() {
        let atk = player.baseAtk;
        let def = player.baseDef;

        if(player.equipment.weapon) {
            atk += player.equipment.weapon.atk;
            def += player.equipment.weapon.def;
        }
        if(player.equipment.armor) {
            atk += player.equipment.armor.atk;
            def += player.equipment.armor.def;
        }
        return { atk, def };
    }

    // --- UIæ›´æ–° ---
    function log(msg) {
        const div = document.getElementById('log');
        div.innerHTML = `<div>${msg}</div>` + div.innerHTML;
    }

    function updateBattleUI() {
        if(!currentEnemy) return;
        document.getElementById('enemy-name').innerText = currentEnemy.name;
        document.getElementById('enemy-emoji').innerText = currentEnemy.emoji;
        
        const hpPct = (currentEnemy.hp / currentEnemy.maxHp) * 100;
        document.getElementById('enemy-hp-bar').style.width = Math.max(0, hpPct) + "%";
        document.getElementById('enemy-hp-text').innerText = `HP: ${currentEnemy.hp}/${currentEnemy.maxHp}`;
        
        updateStatsUI();
    }

    function updateStatsUI() {
        const stats = getPlayerStats();
        document.getElementById('st-lv').innerText = player.lv;
        document.getElementById('st-hp').innerText = `${player.hp}/${player.maxHp}`;
        document.getElementById('st-atk').innerText = stats.atk;
        document.getElementById('st-def').innerText = stats.def;

        const xpPct = (player.xp / player.nextXp) * 100;
        document.getElementById('xp-bar').style.width = xpPct + "%";
        document.getElementById('xp-text').innerText = `LV.${player.lv} (${player.xp}/${player.nextXp})`;

        if(player.equipment.weapon) {
            const w = player.equipment.weapon;
            document.getElementById('eq-weap').innerText = w.name;
            document.getElementById('eq-weap').className = `rarity-${w.rarity}`;
        }
        if(player.equipment.armor) {
            const a = player.equipment.armor;
            document.getElementById('eq-armor').innerText = a.name;
            document.getElementById('eq-armor').className = `rarity-${a.rarity}`;
        }
    }

    function updateUI() {
        updateStatsUI();
        
        // ç´ æãƒªã‚¹ãƒˆ
        const matDiv = document.getElementById('material-list');
        matDiv.innerHTML = '';
        for(let key in MATERIALS) {
            const count = player.inventory[key];
            if(count > 0 || true) { // å…¨ã¦è¡¨ç¤º
                const m = MATERIALS[key];
                const el = document.createElement('div');
                el.className = `rarity-${m.rarity}`;
                el.innerText = `${m.name}: ${count}`;
                if(count === 0) el.style.opacity = 0.3;
                matDiv.appendChild(el);
            }
        }

        // ãƒ¬ã‚·ãƒ”ãƒªã‚¹ãƒˆ
        const recDiv = document.getElementById('recipe-list');
        recDiv.innerHTML = '';
        RECIPES.forEach(r => {
            const el = document.createElement('div');
            el.className = 'item-row';
            
            let reqHtml = '';
            for(let mat in r.req) {
                const has = player.inventory[mat];
                const need = r.req[mat];
                const color = has >= need ? '#8f8' : '#f88';
                reqHtml += `<span style="color:${color}">${MATERIALS[mat].name} ${has}/${need}</span> `;
            }

            const btnDisabled = !canCraft(r) ? 'disabled' : '';

            el.innerHTML = `
                <div class="item-info">
                    <span class="item-name rarity-${r.rarity}">${r.name}</span>
                    <span class="item-req">${reqHtml}</span>
                    <span style="font-size:10px">ATK+${r.atk} DEF+${r.def}</span>
                </div>
                <button class="craft-btn" onclick="craft('${r.id}')" ${btnDisabled}>CRAFT</button>
            `;
            recDiv.appendChild(el);
        });
    }

    // ã‚¹ã‚¿ãƒ¼ãƒˆ
    init();

</script>
</body>
</html>
