<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Simple Gacha RPG (Fixed)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³éƒ¨åˆ†ï¼šã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤å´©ã‚Œã«ãã„è¨­è¨ˆ --- */
        body {
            background-color: #222;
            color: white;
            font-family: sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ã®æ  */
        #game-box {
            max-width: 400px;
            margin: 0 auto;
            background: #333;
            padding: 20px;
            border: 2px solid #555;
            border-radius: 10px;
        }

        /* ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆç”¨ */
        .screen { display: none; }
        .active { display: block; }

        /* ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        button {
            background: #e6b422;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            touch-action: manipulation; /* ã‚¹ãƒãƒ›ã§ã®ã‚¿ãƒƒãƒ—é…å»¶é˜²æ­¢ */
        }
        button:active { background: #c59b10; transform: translateY(2px); }
        button.secondary { background: #666; color: #fff; font-size: 14px; }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status-bar {
            background: #000;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            justify-content: space-around;
        }

        /* ã‚¬ãƒãƒ£çµæœãªã© */
        .card {
            border: 1px solid #fff;
            padding: 10px;
            margin: 5px;
            display: inline-block;
            width: 80px;
            background: #444;
        }
        .ssr { border: 2px solid gold; color: gold; background: #330000; }

        /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #error-log { color: red; background: #fff; display: none; margin-top: 20px; padding: 10px; }
    </style>
</head>
<body>

    <div id="game-box">
        <div class="status-bar">
            <span>ğŸ’çŸ³: <b id="ui-gem">0</b></span>
            <span>ğŸ’°é‡‘: <b id="ui-gold">0</b></span>
        </div>

        <div id="screen-home" class="screen active">
            <h1>ğŸ° ãƒ›ãƒ¼ãƒ </h1>
            <p>æœ€å¼·ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚’ä½œã‚ã†ï¼</p>
            <br>
            <button onclick="gotoGacha()">ğŸ’ ã‚¬ãƒãƒ£ã‚’å¼•ã</button><br>
            <button onclick="gotoBattle()">âš”ï¸ ãƒãƒˆãƒ«ã¸è¡Œã</button>
        </div>

        <div id="screen-gacha" class="screen">
            <h1>ğŸ”® å¬å–šã®é¤¨</h1>
            <p>1å› ğŸ’300å€‹</p>
            <div id="gacha-display" style="min-height: 100px; margin-bottom:10px;">
                (ã“ã“ã«çµæœãŒå‡ºã¾ã™)
            </div>
            <button onclick="pullGacha()">10é€£å¬å–šã™ã‚‹</button><br>
            <button class="secondary" onclick="gotoHome()">æˆ»ã‚‹</button>
        </div>

        <div id="screen-battle" class="screen">
            <h1>ğŸ² ãƒãƒˆãƒ«</h1>
            <div style="font-size: 60px; margin: 20px;" id="enemy-icon">ğŸ‘¿</div>
            <p>æ•µã®HP: <b id="enemy-hp">100</b></p>
            <hr>
            <p>å‘³æ–¹ã®æ”»æ’ƒåŠ›: <b id="party-power">0</b></p>
            <button onclick="attack()">ğŸ‘Š æ”»æ’ƒã™ã‚‹</button><br>
            <button class="secondary" onclick="gotoHome()">é€ƒã’ã‚‹</button>
        </div>

        <div id="screen-result" class="screen">
            <h1 style="color:gold">VICTORY!</h1>
            <p>å ±é…¬: ğŸ’300 GET!</p>
            <button onclick="gotoHome()">ãƒ›ãƒ¼ãƒ ã¸</button>
        </div>

    </div>

    <div id="error-log"></div>

    <script>
        // --- ã‚¨ãƒ©ãƒ¼ç›£è¦–æ©Ÿèƒ½ ---
        window.onerror = function(msg, url, line) {
            const log = document.getElementById("error-log");
            log.style.display = "block";
            log.innerText = "ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: " + msg + " (è¡Œ: " + line + ")";
            alert("ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚\n" + msg);
        };

        // --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ ---
        let gems = 3000;
        let gold = 0;
        let power = 10; // åˆæœŸæ”»æ’ƒåŠ›

        // --- èµ·å‹•æ™‚ã®å‡¦ç† ---
        // ç”»é¢ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰UIã‚’æ›´æ–°ã™ã‚‹å®‰å…¨ç­–
        window.onload = function() {
            try {
                updateUI();
                console.log("ã‚²ãƒ¼ãƒ èµ·å‹•æˆåŠŸ");
            } catch (e) {
                console.error(e);
                alert("èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ");
            }
        };

        // --- ç”»é¢åˆ‡ã‚Šæ›¿ãˆ ---
        function showScreen(screenId) {
            // å…¨ã¦ã®ç”»é¢ã‚’éš ã™
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            // æŒ‡å®šã—ãŸç”»é¢ã ã‘å‡ºã™
            document.getElementById(screenId).classList.add('active');
        }

        function gotoHome() { showScreen('screen-home'); }
        function gotoGacha() { 
            document.getElementById('gacha-display').innerText = "ã‚¬ãƒãƒ£ã‚’å›ã—ã¦æˆ¦åŠ›ã‚’ä¸Šã’ã‚ˆã†ï¼";
            showScreen('screen-gacha'); 
        }
        function gotoBattle() {
            // æ•µã®HPã‚’ã‚»ãƒƒãƒˆ
            document.getElementById('enemy-hp').innerText = "500";
            document.getElementById('enemy-icon').innerText = "ğŸ‘¿";
            showScreen('screen-battle');
        }

        // --- UIæ›´æ–° ---
        function updateUI() {
            document.getElementById('ui-gem').innerText = gems;
            document.getElementById('ui-gold').innerText = gold;
            document.getElementById('party-power').innerText = power;
        }

        // --- ã‚¬ãƒãƒ£æ©Ÿèƒ½ ---
        function pullGacha() {
            if (gems < 3000) {
                alert("çŸ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼ãƒãƒˆãƒ«ã§ç¨¼ã„ã§ãã ã•ã„ã€‚");
                return;
            }
            gems -= 3000;

            const resultsDiv = document.getElementById('gacha-display');
            resultsDiv.innerHTML = ""; // ã‚¯ãƒªã‚¢

            // 10å›ã¾ã‚ã™
            for(let i=0; i<10; i++) {
                let r = Math.random();
                let card = document.createElement("div");
                card.className = "card";
                
                if (r < 0.1) { // 10%ã§SSR
                    card.innerText = "SSR é­”ç‹";
                    card.classList.add("ssr");
                    power += 100; // æ”»æ’ƒåŠ›ã‚¢ãƒƒãƒ—
                } else if (r < 0.4) {
                    card.innerText = "SR é¨å£«";
                    power += 30;
                } else {
                    card.innerText = "N æ‘äºº";
                    power += 5;
                }
                resultsDiv.appendChild(card);
            }
            updateUI();
        }

        // --- ãƒãƒˆãƒ«æ©Ÿèƒ½ ---
        function attack() {
            let ehp = parseInt(document.getElementById('enemy-hp').innerText);
            
            // æ”»æ’ƒï¼
            ehp -= power;
            
            // æ¼”å‡ºï¼ˆå°‘ã—æºã‚‰ã™ï¼‰
            const icon = document.getElementById('enemy-icon');
            icon.style.transform = "translateX(5px)";
            setTimeout(() => icon.style.transform = "translateX(0)", 100);

            if (ehp <= 0) {
                document.getElementById('enemy-hp').innerText = "0";
                // å‹åˆ©
                gems += 3000; // å ±é…¬
                updateUI();
                showScreen('screen-result');
            } else {
                document.getElementById('enemy-hp').innerText = ehp;
            }
        }

    </script>
</body>
</html>
