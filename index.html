<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Block Blast ‚Äî Ë¶ã„ÇÑ„Åô„ÅÑÂÆåÂÖ®Áâà</title>
<style>
body{
  margin:0;
  background:#eef4fb;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:sans-serif;
}
#game{
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}
#score{
  font-size:28px;
  font-weight:bold;
  margin-bottom:10px;
}
#board{
  display:grid;
  grid-template-columns:repeat(8,50px);
  gap:6px;
  background:#dce6f7;
  padding:10px;
  border-radius:10px;
}
.cell{
  width:50px;
  height:50px;
  background:#f8fbff;
  border-radius:10px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
.block{
  width:42px;
  height:42px;
  border-radius:8px;
  box-shadow:
    inset 0 -4px 6px rgba(0,0,0,0.2),
    inset 0 4px 6px rgba(255,255,255,0.4);
}
#pieces{
  margin-top:15px;
  display:flex;
  gap:20px;
}
.piece{
  cursor:pointer;
  padding:5px;
  border-radius:8px;
}
.piece.selected{
  outline:3px solid orange;
}
.mini{
  width:18px;
  height:18px;
  background:#dce6f7;
  border-radius:4px;
}
</style>
</head>
<body>

<div id="game">
  <div id="score">0</div>
  <button id="aiBtn">AI</button>
  <button id="manualBtn">MANUAL</button>
  <div id="board"></div>
  <div id="pieces"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const size=8;
let board=[];
let pieces=[];
let score=0;
let mode="ai";
let selected=null;
let aiBusy=false;

// üîπ Âõ∫ÂÆö„ÅßË¶ã„ÇÑ„Åô„ÅÑËâ≤ÈÖçÂàó
const colors=["#f94144","#f3722c","#f9844a","#f9c74f","#90be6d","#43aa8b","#577590","#7400b8"];

const shapes=[
[[1]],[[1,1]],[[1,1,1]],[[1,1,1,1]],
[[1],[1]],[[1],[1],[1]],
[[1,1],[1,1]],
[[1,0],[1,1]],
[[1,1,1],[0,1,0]]
];

function randColor(){
  return colors[Math.floor(Math.random()*colors.length)];
}

function init(){
  board=Array(size).fill().map(()=>Array(size).fill(0));
  score=0;
  generate();
  draw();
  aiTurn();
}

function generate(){
  pieces=[];
  for(let i=0;i<3;i++){
    pieces.push({
      shape:shapes[Math.floor(Math.random()*shapes.length)],
      color:randColor()
    });
  }
}

function draw(){
  drawBoard();
  drawPieces();
  document.getElementById("score").innerText=score;
}

function drawBoard(){
  const b=document.getElementById("board");
  b.innerHTML="";
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const c=document.createElement("div");
      c.className="cell";
      if(board[y][x]){
        const inner=document.createElement("div");
        inner.className="block";
        inner.style.background=board[y][x];
        c.appendChild(inner);
      }
      c.onclick=()=>{
        if(mode==="manual" && selected!==null){
          place(selected,y,x);
        }
      };
      b.appendChild(c);
    }
  }
}

function drawPieces(){
  const p=document.getElementById("pieces");
  p.innerHTML="";
  pieces.forEach((piece,i)=>{
    const wrapper=document.createElement("div");
    wrapper.className="piece";
    if(i===selected) wrapper.classList.add("selected");
    wrapper.onclick=()=>{
      if(mode==="manual"){
        selected=i;
        draw();
      }
    };

    const grid=document.createElement("div");
    grid.style.display="grid";
    grid.style.gridTemplateColumns=`repeat(${piece.shape[0].length},18px)`;
    grid.style.gap="2px";

    for(let y=0;y<piece.shape.length;y++){
      for(let x=0;x<piece.shape[0].length;x++){
        const m=document.createElement("div");
        m.className="mini";
        if(piece.shape[y][x]){
          m.style.background=piece.color;
        }
        grid.appendChild(m);
      }
    }

    wrapper.appendChild(grid);
    p.appendChild(wrapper);
  });
}

function canPlace(shape,y,x,temp=board){
  for(let dy=0;dy<shape.length;dy++){
    for(let dx=0;dx<shape[0].length;dx++){
      if(shape[dy][dx]){
        if(y+dy>=size||x+dx>=size||temp[y+dy][x+dx]) return false;
      }
    }
  }
  return true;
}

function place(index,y,x){
  const piece=pieces[index];
  if(!canPlace(piece.shape,y,x)) return;

  for(let dy=0;dy<piece.shape.length;dy++){
    for(let dx=0;dx<piece.shape[0].length;dx++){
      if(piece.shape[dy][dx]){
        board[y+dy][x+dx]=piece.color;
        score++;
      }
    }
  }

  pieces.splice(index,1);
  if(pieces.length===0) generate();
  selected=null;
  draw();
}

function aiTurn(){
  if(mode!=="ai"||aiBusy) return;
  aiBusy=true;

  setTimeout(()=>{
    let placed=false;
    for(let i=0;i<pieces.length;i++){
      for(let y=0;y<size;y++){
        for(let x=0;x<size;x++){
          if(canPlace(pieces[i].shape,y,x)){
            place(i,y,x);
            placed=true;
            break;
          }
        }
        if(placed) break;
      }
      if(placed) break;
    }

    if(!placed){
      alert("GAME OVER");
      aiBusy=false;
      return;
    }

    aiBusy=false;
    aiTurn();
  },200);
}

document.getElementById("aiBtn").onclick=()=>{
  mode="ai";
  aiTurn();
};

document.getElementById("manualBtn").onclick=()=>{
  mode="manual";
};

init();

});
</script>

</body>
</html>
