<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Cosmic Evolution: æ˜Ÿã®ç²¾éœŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            margin: 0; padding: 0;
            background: #111; color: #fff;
            font-family: 'Courier New', sans-serif;
            overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh;
        }

        #game-container {
            position: relative;
            width: 500px; height: 700px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border: 4px solid #444;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* ä¸Šéƒ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        #header {
            padding: 15px;
            background: rgba(0,0,0,0.5);
            display: flex; justify-content: space-between;
            border-bottom: 2px solid #444;
        }
        .stat-box { font-weight: bold; font-size: 14px; }
        .val-str { color: #ff5555; }
        .val-int { color: #55aaff; }
        .val-luck { color: #ffdd55; }

        /* ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼ˆCanvasï¼‰ */
        #canvas-wrapper {
            flex-grow: 1;
            position: relative;
            background: radial-gradient(circle at center, #2a2a40 0%, #000 100%);
            cursor: pointer;
        }
        canvas { display: block; width: 100%; height: 100%; }

        /* HPãƒãƒ¼ */
        #hp-container {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 60%; height: 10px; background: #333; border-radius: 5px;
            border: 1px solid #fff;
        }
        #hp-bar {
            width: 100%; height: 100%; background: #00ff88;
            border-radius: 5px; transition: width 0.3s;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        #controls {
            height: 180px;
            background: #222;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px; padding: 10px;
        }
        
        .btn {
            background: #333; border: 2px solid #555; color: white;
            border-radius: 10px; font-size: 16px; font-weight: bold;
            cursor: pointer; transition: 0.1s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); background: #444; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn span { font-size: 12px; margin-top: 4px; color: #aaa; }

        #btn-str { border-bottom: 4px solid #aa3333; }
        #btn-int { border-bottom: 4px solid #3366aa; }
        #btn-luck { border-bottom: 4px solid #aa9933; }
        #btn-eat { border-bottom: 4px solid #33aa66; background: #2f3f2f; }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚° */
        #log {
            position: absolute; top: 60px; width: 100%;
            text-align: center; font-size: 14px; color: #fff;
            text-shadow: 0 1px 2px #000;
            pointer-events: none;
            height: 20px;
        }

        /* é€²åŒ–é€šçŸ¥ */
        #evolution-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.5s;
        }
        #evo-title { font-size: 30px; color: #ffd700; margin-bottom: 20px; font-family: 'Press Start 2P', cursive; text-align: center; line-height: 1.5;}
        #evo-desc { font-size: 16px; color: #ccc; margin-bottom: 30px; }
        #evo-btn { padding: 10px 30px; font-size: 20px; cursor: pointer; background: #fff; border: none; border-radius: 5px; }

    </style>
</head>
<body>

    <div id="game-container">
        <div id="header">
            <div class="stat-box">LV: <span id="val-lv">1</span></div>
            <div class="stat-box val-str">STR: <span id="val-str">0</span></div>
            <div class="stat-box val-int">INT: <span id="val-int">0</span></div>
            <div class="stat-box val-luck">LUCK: <span id="val-luck">0</span></div>
        </div>

        <div id="canvas-wrapper" onclick="petCreature(event)">
            <div id="log">è‚²æˆã‚’é–‹å§‹ã—ã¾ã™...</div>
            <canvas id="gameCanvas"></canvas>
            <div id="hp-container"><div id="hp-bar"></div></div>
        </div>

        <div id="controls">
            <button class="btn" id="btn-str" onclick="train('str')">âš”ï¸ ç‰¹è¨“ (STR)<span>HP -15</span></button>
            <button class="btn" id="btn-int" onclick="train('int')">ğŸ“š ç‘æƒ³ (INT)<span>HP -15</span></button>
            <button class="btn" id="btn-luck" onclick="train('luck')">ğŸ² æ¢ç´¢ (LUCK)<span>HP -15</span></button>
            <button class="btn" id="btn-eat" onclick="eat()">ğŸ– é£Ÿäº‹ (Heal)<span>HP +40</span></button>
        </div>

        <div id="evolution-overlay">
            <div id="evo-title">EVOLUTION!</div>
            <div id="evo-desc">æ–°ãŸãªå§¿ã¸é€²åŒ–ã—ã¾ã—ãŸ</div>
            <button id="evo-btn" onclick="closeOverlay()">OK</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Canvasã‚µã‚¤ã‚ºèª¿æ•´
        const rect = document.getElementById('canvas-wrapper').getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let stats = {
            lv: 1,
            exp: 0,
            nextExp: 3, // æœ€åˆã¯ã™ãé€²åŒ–
            hp: 100,
            maxHp: 100,
            str: 5,
            int: 5,
            luck: 5
        };

        // ç”Ÿãç‰©ã®å®šç¾©
        let creature = {
            type: 'blob', // blob, fire, water, leaf, gold, dark, god
            name: 'ãƒ—ãƒç²¾éœŠ',
            color: '#00ccff',
            size: 40,
            eyeSize: 4,
            pulseSpeed: 0.05,
            particles: []
        };
        
        let frame = 0;
        let isAnimating = true;

        // é€²åŒ–ãƒ„ãƒªãƒ¼å®šç¾©
        const EVOLUTIONS = {
            'blob': { next: 5, desc: "ã¾ã ä½•ã‚‚çŸ¥ã‚‰ãªã„ç´”ç²‹ãªç²¾éœŠ" },
            // ç¬¬2æ®µéš
            'warrior': { color: '#ff4444', name: 'ã‚¤ãƒ•ãƒªãƒ¼ãƒˆ', desc: "é—˜äº‰æœ¬èƒ½ã«ç›®è¦šã‚ãŸç‚ã®ç²¾éœŠ" },
            'mage':    { color: '#4444ff', name: 'ã‚¦ãƒ³ãƒ‡ã‚£ãƒ¼ãƒ', desc: "çŸ¥æ€§ã‚’å®¿ã—ãŸæ°´ã®ç²¾éœŠ" },
            'thief':   { color: '#ffff44', name: 'ãƒˆãƒ¬ã‚¸ãƒ£ãƒ¼', desc: "å¯Œã¨é‹ã‚’å¸ã‚‹é»„é‡‘ã®ç²¾éœŠ" },
            // ç¬¬3æ®µéš (æœ€çµ‚)
            'demon':   { color: '#880000', name: 'é­”ç¥ã‚¢ã‚·ãƒ¥ãƒ©', desc: "åŠ›ã‚’æ¥µã‚ã—ç ´å£Šã®åŒ–èº«" },
            'sage':    { color: '#8844ff', name: 'å¤§è³¢è€…', desc: "å®‡å®™ã®çœŸç†ã«åˆ°é”ã—ãŸå­˜åœ¨" },
            'joker':   { color: '#00ff00', name: 'ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼', desc: "é‹å‘½ã™ã‚‰é¨™ã™å¹»å½±ã®ç‹" },
            'hero':    { color: '#ffffff', name: 'æ˜Ÿã®æ•‘ä¸–ä¸»', desc: "ãƒãƒ©ãƒ³ã‚¹ã‚ˆãè‚²ã£ãŸå¥‡è·¡ã®å­˜åœ¨" }
        };

        // --- ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— ---
        function loop() {
            if(!isAnimating) return;
            frame++;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawCreature();
            updateParticles();
            
            requestAnimationFrame(loop);
        }
        loop();

        // --- æç”»ãƒ­ã‚¸ãƒƒã‚¯ (ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³) ---
        function drawCreature() {
            const cx = canvas.width / 2;
            const cy = canvas.height / 2 + Math.sin(frame * creature.pulseSpeed) * 10;
            
            // æœ¬ä½“ï¼ˆæºã‚‰ãå††ï¼‰
            ctx.fillStyle = creature.color;
            ctx.beginPath();
            
            // ç”Ÿãç‰©ã£ã½ãé ‚ç‚¹ã‚’å‹•ã‹ã™
            const points = 12;
            for(let i=0; i<=points; i++) {
                const angle = (i / points) * Math.PI * 2;
                // ãƒã‚¤ã‚ºã‚’åŠ ãˆã‚‹
                const rOffset = Math.sin(frame * 0.1 + i * 1.5) * 3 + Math.sin(frame * 0.05) * (stats.lv * 2); 
                const r = creature.size + rOffset;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                if(i===0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            
            // å…‰å½©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            ctx.shadowBlur = 20 + Math.sin(frame * 0.1) * 10;
            ctx.shadowColor = creature.color;
            ctx.fill();
            ctx.shadowBlur = 0;

            // ç›®
            ctx.fillStyle = 'white';
            const eyeOffset = Math.sin(frame * 0.05) * 2;
            
            // ç›®ã®å½¢ã‚„æ•°ã‚’é€²åŒ–ã«ã‚ˆã£ã¦å¤‰ãˆã‚‹
            if (creature.type === 'mage' || creature.type === 'sage') {
                 // 1ã¤ç›®
                ctx.beginPath(); ctx.arc(cx, cy - 5, creature.eyeSize * 1.5, 0, Math.PI * 2); ctx.fill();
            } else if (creature.type === 'demon') {
                // æ€–ã„ç›®
                ctx.fillStyle = '#ffff00';
                ctx.beginPath(); ctx.moveTo(cx-15, cy-10); ctx.lineTo(cx-5, cy); ctx.lineTo(cx-15, cy+5); ctx.fill();
                ctx.beginPath(); ctx.moveTo(cx+15, cy-10); ctx.lineTo(cx+5, cy); ctx.lineTo(cx+15, cy+5); ctx.fill();
            } else {
                // æ™®é€šã®ç›®
                ctx.beginPath(); ctx.arc(cx - 12, cy - 5 + eyeOffset, creature.eyeSize, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.arc(cx + 12, cy - 5 + eyeOffset, creature.eyeSize, 0, Math.PI * 2); ctx.fill();
            }
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (frame % 60 === 0 && stats.exp > 0) {
                 // å°‘ã—å…‰ã‚‰ã›ã‚‹ãªã©
            }
        }

        // --- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ  ---
        function spawnParticles(x, y, color, count) {
            for(let i=0; i<count; i++) {
                creature.particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 5,
                    vy: (Math.random() - 0.5) * 5,
                    life: 1.0,
                    color: color
                });
            }
        }
        function updateParticles() {
            for(let i=creature.particles.length-1; i>=0; i--) {
                let p = creature.particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.03;
                
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
                ctx.globalAlpha = 1.0;

                if(p.life <= 0) creature.particles.splice(i, 1);
            }
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateUI() {
            document.getElementById('val-lv').innerText = stats.lv;
            document.getElementById('val-str').innerText = stats.str;
            document.getElementById('val-int').innerText = stats.int;
            document.getElementById('val-luck').innerText = stats.luck;
            
            const hpPct = Math.max(0, (stats.hp / stats.maxHp) * 100);
            const hpBar = document.getElementById('hp-bar');
            hpBar.style.width = hpPct + '%';
            hpBar.style.background = hpPct > 20 ? '#00ff88' : '#ff0000';

            // ãƒœã‚¿ãƒ³åˆ¶å¾¡
            const disabled = stats.hp < 15;
            document.getElementById('btn-str').disabled = disabled;
            document.getElementById('btn-int').disabled = disabled;
            document.getElementById('btn-luck').disabled = disabled;
            document.getElementById('btn-eat').disabled = stats.hp >= stats.maxHp;
        }

        function log(msg) {
            const el = document.getElementById('log');
            el.innerText = msg;
            el.style.opacity = 1;
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆç”¨
            el.animate([{ opacity: 0, transform: 'translateY(10px)' }, { opacity: 1, transform: 'translateY(0)' }], { duration: 300 });
        }

        function train(type) {
            if (stats.hp < 15) return;
            
            stats.hp -= 15;
            stats.exp++;
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸Šæ˜‡
            const gain = Math.floor(Math.random() * 3) + 2; // 2~4
            stats[type] += gain;

            // æ¼”å‡º
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            let color = '#fff';
            if(type === 'str') { log(`ç­‹ãƒˆãƒ¬å®Œäº†ï¼ STR +${gain}`); color = '#ff5555'; }
            if(type === 'int') { log(`å‹‰å¼·ã—ã¾ã—ãŸã€‚ INT +${gain}`); color = '#55aaff'; }
            if(type === 'luck') { log(`ä½•ã‹ã‚’æ‹¾ã£ãŸï¼ LUCK +${gain}`); color = '#ffdd55'; }
            
            spawnParticles(cx, cy, color, 10);
            
            // é€²åŒ–ãƒã‚§ãƒƒã‚¯
            if (stats.exp >= stats.nextExp) {
                levelUp();
            }
            updateUI();
        }

        function eat() {
            if (stats.hp >= stats.maxHp) return;
            stats.hp = Math.min(stats.maxHp, stats.hp + 40);
            log("ã”é£¯ã‚’é£Ÿã¹ã¾ã—ãŸã€‚HPå›å¾©ï¼");
            spawnParticles(canvas.width/2, canvas.height/2, '#00ff00', 15);
            updateUI();
        }

        function petCreature(e) {
            // ã‚¯ãƒªãƒƒã‚¯ã§æ’«ã§ã‚‹
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            spawnParticles(x, y, '#ff99cc', 5);
            log("ãªã§ãªã§...");
        }

        function levelUp() {
            stats.lv++;
            stats.exp = 0;
            stats.nextExp = Math.floor(stats.nextExp * 1.5);
            stats.maxHp += 20;
            stats.hp = stats.maxHp;

            // é€²åŒ–åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            // LV 5ã§ç¬¬2å½¢æ…‹ã€LV 10ã§æœ€çµ‚å½¢æ…‹
            let newType = null;

            if (stats.lv === 5) {
                if (stats.str > stats.int && stats.str > stats.luck) newType = 'warrior';
                else if (stats.int > stats.str && stats.int > stats.luck) newType = 'mage';
                else newType = 'thief';
            }
            else if (stats.lv === 10) {
                // æœ€çµ‚é€²åŒ–åˆ†å²
                const base = creature.type;
                if (base === 'warrior') newType = 'demon'; // ç­‹åŠ›ãƒ«ãƒ¼ãƒˆ
                else if (base === 'mage') newType = 'sage'; // çŸ¥åŠ›ãƒ«ãƒ¼ãƒˆ
                else if (base === 'thief') newType = 'joker'; // é‹ãƒ«ãƒ¼ãƒˆ
                else {
                    // ãƒãƒ©ãƒ³ã‚¹å‹ï¼ˆéš ã—ï¼‰
                    if (Math.abs(stats.str - stats.int) < 10 && Math.abs(stats.int - stats.luck) < 10) {
                        newType = 'hero';
                    } else {
                         // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€²åŒ–
                         if(stats.str >= stats.int) newType = 'demon';
                         else newType = 'sage';
                    }
                }
            }

            if (newType) {
                evolve(newType);
            } else {
                log(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${stats.lv}`);
                creature.size += 5; // å°‘ã—å¤§ãããªã‚‹
                spawnParticles(canvas.width/2, canvas.height/2, '#ffffff', 30);
            }
        }

        function evolve(typeKey) {
            const data = EVOLUTIONS[typeKey];
            creature.type = typeKey;
            creature.color = data.color;
            creature.name = data.name;
            creature.size += 15;
            
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
            const ol = document.getElementById('evolution-overlay');
            ol.style.opacity = 1;
            ol.style.pointerEvents = 'auto';
            document.getElementById('evo-title').innerText = data.name;
            document.getElementById('evo-title').style.color = data.color;
            document.getElementById('evo-desc').innerText = data.desc;
            
            spawnParticles(canvas.width/2, canvas.height/2, data.color, 100);
        }

        function closeOverlay() {
            const ol = document.getElementById('evolution-overlay');
            ol.style.opacity = 0;
            ol.style.pointerEvents = 'none';
            // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®š
            if (stats.lv >= 10) {
                log("ç©¶æ¥µé€²åŒ–ã‚’é”æˆã—ã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ï¼");
                // ã“ã‚Œä»¥ä¸Šã¯é€²åŒ–ã—ãªã„
                stats.nextExp = 9999; 
            }
        }

        updateUI();

    </script>
</body>
</html>
